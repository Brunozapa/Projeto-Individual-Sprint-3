YUI.add("hermes-template-profile-bio-showcase",function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,a){var o,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"is-viewing-self "+(null!=(o=s(l,"if").call(null!=e?e:n.nullContext||{},null!=e?s(e,"showcaseIsEmpty"):e,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:58},end:{line:1,column:97}}}))?o:"")+" "},2:function(n,e,l,t,a){return" is-empty"},4:function(n,e,l,t,a){var o,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return null!=(o=s(l,"if").call(null!=e?e:n.nullContext||{},null!=e?s(e,"showcaseIsEmpty"):e,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:106},end:{line:1,column:143}}}))?o:""},5:function(n,e,l,t,a){return" hidden"},7:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"profile.PROFILE_SHOWCASE_TITLE_SHORT"},data:a,loc:{start:{line:3,column:76},end:{line:3,column:139}}}))},9:function(n,e,l,t,a){var o,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression(n.lambda(null!=(o=null!=e?s(e,"showcase"):e)?s(o,"title"):o,e))},11:function(n,e,l,t,a){return'<span tabindex="0" id="editShowcaseTitle" class="edit-title-svg"><svg class="icon icon-edit icon-edit-showcase-title"><use xlink:href="#icon-edit"></use></svg></span>'},13:function(n,e,l,t,a){var o,s=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,r=n.escapeExpression,c=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<p class="showcase-title-edit" tabindex="0"><input type="text" maxlength="50" placeholder="'+r((c(l,"intlMessage")||e&&c(e,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"profile.PROFILE_SHOWCASE_TITLE_SHORT"},data:a,loc:{start:{line:7,column:93},end:{line:7,column:156}}}))+'" value="'+r(n.lambda(null!=(o=null!=e?c(e,"showcase"):e)?c(o,"title"):o,e))+'"><span class="success-check"></span>\n\t\t\t<button class="btn done-edit-title">'+r((c(l,"intlMessage")||e&&c(e,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"common.DONE"},data:a,loc:{start:{line:8,column:39},end:{line:8,column:77}}}))+"</button>\n\t\t\t<span>"+r((c(l,"intlMessage")||e&&c(e,"intlMessage")||i).call(s,{name:"intlMessage",hash:{intlName:"profile.PROFILE_SAVED_AUTO"},data:a,loc:{start:{line:9,column:9},end:{line:9,column:62}}}))+"</span>\n\t\t</p>\n"},15:function(n,e,l,t,a){var o=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t<a class="toggle-edit-showcase" tabindex="0" title="'+n.escapeExpression((o(l,"intlMessage")||e&&o(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"profile.EDIT_SHOWCASE"},data:a,loc:{start:{line:14,column:54},end:{line:14,column:102}}}))+'">\n\t\t\t<svg class="icon icon-add"><use xlink:href="#icon-add"></use></svg>\n\t\t</a>\n'},17:function(n,e,l,t,a){var o,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return null!=(o=s(l,"if").call(null!=e?e:n.nullContext||{},null!=e?s(e,"showcaseIsEmpty"):e,{name:"if",hash:{},fn:n.program(18,a,0),inverse:n.noop,data:a,loc:{start:{line:22,column:2},end:{line:30,column:9}}}))?o:""},18:function(n,e,l,t,a){var o,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return null!=(o=s(l,"if").call(null!=e?e:n.nullContext||{},null!=e?s(e,"noShowcaseSet"):e,{name:"if",hash:{},fn:n.noop,inverse:n.program(19,a,0),data:a,loc:{start:{line:23,column:3},end:{line:29,column:10}}}))?o:""},19:function(n,e,l,t,a){var o=null!=e?e:n.nullContext||{},s=n.hooks.helperMissing,i=n.escapeExpression,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'\t\t\t\t<div class="empty-showcase-bg">\n\t\t\t\t\t<p>'+i((r(l,"intlMessage")||e&&r(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{intlName:"profile.THIS_YOUR_SHOWCASE"},data:a,loc:{start:{line:25,column:8},end:{line:25,column:61}}}))+"</p>\n\t\t\t\t\t<p>"+i((r(l,"intlMessage")||e&&r(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{limit:null!=e?r(e,"maxLimitShowcase"):e,intlName:"profile.SHOW_OFF_YOUR_PHOTOS"},data:a,loc:{start:{line:26,column:8},end:{line:26,column:86}}}))+'</p>\n\t\t\t\t\t<p><a class="get-started">'+i((r(l,"intlMessage")||e&&r(e,"intlMessage")||s).call(o,{name:"intlMessage",hash:{intlName:"profile.GET_STARTED"},data:a,loc:{start:{line:27,column:31},end:{line:27,column:77}}}))+"</a></p>\n\t\t\t\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,a){var o,s=null!=e?e:n.nullContext||{},i=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="showcase '+(null!=(o=i(l,"if").call(s,null!=e?i(e,"isViewingSelf"):e,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(4,a,0),data:a,loc:{start:{line:1,column:21},end:{line:1,column:150}}}))?o:"")+'">\n\t<div class="profile-showcase-title-container">\n\t\t<p class="showcase-title-view"><span class="title">'+(null!=(o=i(l,"if").call(s,null!=e?i(e,"hasDefaultTitle"):e,{name:"if",hash:{},fn:n.program(7,a,0),inverse:n.program(9,a,0),data:a,loc:{start:{line:3,column:53},end:{line:3,column:172}}}))?o:"")+"</span>\n\t\t\t"+(null!=(o=i(l,"if").call(s,null!=e?i(e,"isViewingSelf"):e,{name:"if",hash:{},fn:n.program(11,a,0),inverse:n.noop,data:a,loc:{start:{line:4,column:3},end:{line:4,column:197}}}))?o:"")+"\n\t\t</p>\n"+(null!=(o=i(l,"if").call(s,null!=e?i(e,"isViewingSelf"):e,{name:"if",hash:{},fn:n.program(13,a,0),inverse:n.noop,data:a,loc:{start:{line:6,column:2},end:{line:11,column:9}}}))?o:"")+"\t</div>\n"+(null!=(o=i(l,"if").call(s,null!=e?i(e,"isViewingSelf"):e,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:13,column:1},end:{line:17,column:8}}}))?o:"")+"\n\t"+n.escapeExpression((i(l,"outlet")||e&&i(e,"outlet")||n.hooks.helperMissing).call(s,null!=e?i(e,"photo-list-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:19,column:1},end:{line:19,column:27}}}))+"\n\n"+(null!=(o=i(l,"if").call(s,null!=e?i(e,"isViewingSelf"):e,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:21,column:1},end:{line:31,column:8}}}))?o:"")+"</div>\n"},useData:!0}),t={};n.Array.each([],function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)}),n.Template.register("hermes/profile-bio-showcase",function(e,a){return a=a||{},a.partials=a.partials?n.merge(t,a.partials):t,l(e,a)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("profile-bio-showcase-view",function(e){e.namespace("Views")[this.name]=e.Base.create("profile-bio-showcase-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.isViewingSelf=e.isViewingSelf,this.showcaseSetId=e.showcaseSetId,this.viewerNsid=this.appContext.getViewer().nsid,this.noShowcaseSet=0===parseInt(this.showcaseSetId,10),this.isAddingPhotoToShowcase=!1,this.showcaseIsEmpty=!1,e.modelRegistryName="set-models",e.photoListConfig={parentName:"showcase-container",measureAFT:!0,paginateOnScroll:!1,keepAwakeOnScroll:!0,maintainScrollPosition:!0,pageParams:{page:1,nominalPage:1,viewPageSize:25,perPage:25},subviewMapping:{"photo-models":{name:"photo-list-photo-view",params:{removeShowCasePhoto:this.isViewingSelf&&!this.isMobile}}}},e.photoListConfig.modelParams={registryName:"set-models",modelIdOrAttributes:this.showcaseSetId,collectionAttributeName:"photoPageList",fetchParams:{userId:this.nsid,id:this.showcaseSetId,includeHiddenSets:!0,viewAs:"public",page:1,nominalPage:1,viewPageSize:25,perPage:25}},e.photoListConfig.layout={targetRowHeight:175,targetRowHeightTolerance:.2,containerPadding:{top:0,right:0,bottom:8,left:0},itemSpacing:{horizontal:4,vertical:4}},this.photoListConfig=e.photoListConfig,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return this.noShowcaseSet}}},loadState:function(){var t=[this.appContext.getModel("person-models",this.nsid)];return this.noShowcaseSet?this.showcaseIsEmpty=!0:t.push(this.appContext.getModel("set-models",{userId:this.viewerNsid,id:this.showcaseSetId,includeHiddenSets:!0})),e.Promise.all(t).then(function(e){if(this.set("personModel",e[0]),e[1]){var t=e[1];t?(this.set("showcaseSetModel",t),0===t.getValue("totalCount")&&(this.showcaseIsEmpty=!0)):this.set("showcaseSetModel",!1)}else this.set("showcaseSetModel",!1)}.bind(this))},buildContainer:function(){var e,t;return this.get("showcaseSetModel")?(t=!1,"Profile Showcase"===(e=this.get("showcaseSetModel").toJSON()).title&&(t=!0),this.setContainerWithTemplate("profile-bio-showcase",{isViewingSelf:this.isViewingSelf,hasReachedLimit:25===e.photoPageList.length,onePhotoLeft:e.photoPageList.length+1===25,showcase:e,noShowcaseSet:!1,hasDefaultTitle:t,maxLimitShowcase:25,showcaseIsEmpty:this.showcaseIsEmpty,person:this.get("personModel").toJSON()})):this.setContainerWithTemplate("profile-bio-showcase",{isViewingSelf:this.isViewingSelf,noShowcaseSet:!0,showcaseIsEmpty:!0,person:this.get("personModel").toJSON()}),this},activate:function(){var e=this.get("container");return this.isViewingSelf&&(this.registerEventHandler(e.delegate("click",this.openPhotoSelector.bind(this),".toggle-edit-showcase")),this.registerEventHandler(e.delegate("key",this.openPhotoSelector.bind(this),"down:13",".toggle-edit-showcase")),this.registerEventHandler(e.delegate("click",this.openPhotoSelector.bind(this),".get-started")),this.registerEventHandler(e.delegate("click",this.onEditShowcaseClick.bind(this),".showcase-title-view")),this.registerEventHandler(e.delegate("key",this.onEditShowcaseClick.bind(this),"down:13",".showcase-title-view",this)),this.registerEventHandler(e.delegate("click",this.onEditShowcaseClick.bind(this),".done-edit-title")),this.registerEventHandler(e.delegate("keyup",this.onEditShowcaseTitleInput.bind(this),".showcase-title-edit input"))),this},openPhotoSelector:function(){var t,i=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"selection",name:this.intlMessage({intlName:"profile.SELECTED"}),value:"selection"}],s={hasUploadCapabilities:!1,appContext:this.appContext,enableMultiSelect:!0,multiSelectLimit:25,preSelectedPhotos:this.get("showcaseSetModel").getValue("photoPageList").getList(),enableVideos:!0,publicOnlyPhotos:!0,searchable:{yours:!0}},o=25-s.preSelectedPhotos.length,n=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"selection",name:this.intlMessage({intlName:"profile.SELECTED"}),value:"selection"}],a=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}];this.showcasePhotoPicker&&this.showcasePhotoPicker.destroy({remove:!0}),t=1===o?this.intlMessage({intlName:"profile.SHOWCASE_ALMOST_FULL"}):0===o?this.intlMessage({intlName:"profile.SHOWCASE_FULL"}):this.intlMessage({intlName:"profile.CHOOSE_UP_TO_PHOTOS",limit:o}),this.showcasePhotoPicker=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,buttonFlavorText:t,handleAction:!1,showCancelButton:!1,showCancelX:!0,navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:this.appContext,links:i,enableSearch:!0,breakpointConfig:[{maxWidth:700,links:n,enableSearch:!1},{maxWidth:500,links:a,enableSearch:!1}]}),actionButtonLabel:this.intlMessage({intlName:"profile.SELECT_PHOTOS"}),actionButtonDisabled:!1,subview:new e.Views["photo-selector-view"](s),width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector profile-showcase-selector",hideModalOverlay:!1,flexLayout:!0}),this.showcasePhotoPicker.show(),this.toggleShowcaseViewState(!0),this.isAddingPhotoToShowcase=!1,this.showcasePhotoPicker.registerEventHandler(e.on("photoSelector:selected",function(e){this.showcasePhotoPicker.enableActionButton()}.bind(this))),this.showcasePhotoPicker.registerEventHandler(e.on("photoSelector:updateCount",function(t){var i=e.one(".photo-selector .flavor-text");i&&(1===t.count?i.setHTML(this.intlMessage({intlName:"profile.SHOWCASE_ALMOST_FULL"})):0===t.count?i.setHTML(this.intlMessage({intlName:"profile.SHOWCASE_FULL"})):i.setHTML(this.intlMessage({intlName:"profile.CHOOSE_UP_TO_PHOTOS",limit:t.count})))}.bind(this))),this.registerEventHandler(this.showcasePhotoPicker.on("actionClick",this.onPhotoSelectedInShowcasePicker.bind(this))),this.registerEventHandler(this.showcasePhotoPicker.on("close",function(e){this.isAddingPhotoToShowcase||(this.toggleShowcaseViewState(!1),this.showcasePhotoPicker.get("subview").get("selectionModel").getValue("photos").removePage({page:1,perPage:25}))}.bind(this))),e.rapidTracker.beacon(this.name,"profileShowcaseEdit")},onPhotoSelectedInShowcasePicker:function(t){var i,s=this.get("showcaseSetModel"),o=[],n=[];this.isAddingPhotoToShowcase=!0,this.showcasePhotoPicker&&this.showcasePhotoPicker.close();var a=this.showcasePhotoPicker.get("subview").get("selectionModel").getValue("photos");return s.getValue("photoPageList").getList().forEach(function(e,t){var i=e.getValue("id");a.getFromListByID(i)||o.push(i)}),a.getList().forEach(function(e,t){var i=e.getValue("id");s.hasPhoto(i)||n.push(i)}),this.appContext.getModel("set-models",{id:this.showcaseSetId,userId:this.viewerNsid,includeHiddenSets:!0}).then(function(e){var t=e;return this.set("showcaseSetModel",t),this.toggleShowcaseViewState(!0),i=t.registry.remote.addPhoto({setID:this.showcaseSetId,isMultiplePhotos:!0,photoID:n.toString(),photosSelectedIds:n,userId:this.viewerNsid,includeHiddenSets:!0},this.appContext).then(function(e){o.length?t.registry.remote.removePhoto({setID:this.showcaseSetId,isMultiplePhotos:!0,photoID:o.toString(),photosSelectedIds:o,userId:this.viewerNsid,includeHiddenSets:!0},this.appContext).then(function(e){this.refreshShowcaseView()}.bind(this)):this.refreshShowcaseView()}.bind(this))}.bind(this)).then(null,function(t){if(t){new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),textMessage:t,appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!0}).show(),this.refreshShowcaseView()}}.bind(this))},refreshShowcaseView:function(){var t=this.get("container").getDOMNode().offsetTop;return this.appContext.getModelRegistry("set-models",{userId:this.viewerNsid,id:this.showcaseSetId,includeHiddenSets:!0}).then(function(i){return i.remove(this.showcaseSetId),this.appContext.getModel("set-models",{userId:this.viewerNsid,id:this.showcaseSetId,includeHiddenSets:!0}).then(function(i){this.set("showcaseSetModel",i),this.showcaseIsEmpty=0===this.get("showcaseSetModel").getValue("totalCount")||isNaN(this.get("showcaseSetModel").getValue("totalCount")),this.showcaseIsEmpty?(this.subviews["photo-list-view"].setItems([]),this.subviews["photo-list-view"].handleResize(null,!0)):this.subviews["photo-list-view"].setItems(this.get("showcaseSetModel").getValue("photoPageList").getList()),this.toggleShowcaseViewState(!1),this.buildContainer(),e.config.win.scrollTo(0,t),e.use("anim",function(e){new e.Anim({duration:.5,node:"win",easing:"easeBoth",to:{scroll:[0,t-100]}}).run()})}.bind(this)).catch(function(t){var i=new e.Views.FluidModal({title:this.intlMessage({intlName:"profile.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.REFRESH"}),textMessage:this.intlMessage({intlName:"profile.SHOWCASE_ERR"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!1,hideModalOverlay:!1,showCancelX:!1});this.registerEventHandler(i.on("actionClick",function(){e.config.win.location.href=e.config.win.location.href}.bind(this))),i.show()}.bind(this))}.bind(this))},onSubviewEvent:function(e,t){if(t&&"showcase:remove"===t[0]){var i=t[2];return this.toggleShowcaseViewState(!0),this.get("showcaseSetModel").registry.remote.removePhoto({setID:this.showcaseSetId,photoID:i,userId:this.viewerNsid,includeHiddenSets:!0},this.appContext).then(function(e){this.set("showcaseSetModel",e),this.refreshShowcaseView()}.bind(this))}},toggleShowcaseViewState:function(e){var t=this.get("container");e?t.addClass("disable"):t.removeClass("disable")},onEditShowcaseClick:function(){this.get("container").one(".profile-showcase-title-container").toggleClass("is-editing")},onEditShowcaseTitleInput:function(e){e.currentTarget;var t=this.get("container").one(".showcase-title-edit");t.removeClass("error"),t.removeClass("success"),13===e.keyCode?(this.isEditingTimer&&clearTimeout(this.isEditingTimer),this.saveNewShowcaseTitle(e)):(this.isEditingTimer&&clearTimeout(this.isEditingTimer),this.isEditingTimer=setTimeout(function(){this.saveNewShowcaseTitle(e)}.bind(this),1e3))},sanitizeShowcaseTitle:function(e){var t=e?e.slice(0,50):"";return(!e||e.length<1||0===e.trim().length)&&(t=this.intlMessage({intlName:"profile.PROFILE_SHOWCASE_TITLE_SHORT"})),t},saveNewShowcaseTitle:function(t){t.currentTarget;var i=this.get("container"),s=i.one(".showcase-title-edit"),o=i.one(".showcase-title-view span.title"),n=i.one(".done-edit-title"),a=this.sanitizeShowcaseTitle(t?t.currentTarget.get("value"):"");this.showcaseSetId,this.appContext.getViewer().nsid;n.set("innerText",this.intlMessage({intlName:"profile.SAVING"})),n.setAttribute("disabled","disabled"),this.appContext.getModel("set-models",{userId:this.nsid,id:this.showcaseSetId,includeHiddenSets:!0}).then(function(t){return e.ModelUpdaters["flickr-photosets-editMeta"].run({photosetId:this.showcaseSetId,title:a,includeHiddenSets:!0,description:t.getValue("description")},this.appContext).then(function(){o.set("innerText",t.getValue("title")),s.one("input").set("value",t.getValue("title")),n.set("innerText",this.intlMessage({intlName:"common.DONE"})),n.removeAttribute("disabled"),s.addClass("success"),s.removeClass("error")}.bind(this)).catch(function(){s.removeClass("success"),s.addClass("error"),n.set("innerText",this.intlMessage({intlName:"common.DONE"})),n.removeAttribute("disabled")}.bind(this))}.bind(this))}})},"@VERSION@",{requires:["flutil","flickr-view","set-models","photo-privacy-models","hermes-template-profile-bio-showcase"],langBundles:["common","profile"]});