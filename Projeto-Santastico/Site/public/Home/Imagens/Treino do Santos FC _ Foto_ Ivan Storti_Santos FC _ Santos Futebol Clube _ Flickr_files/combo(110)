YUI.add("hermes-template-profile-bio-privacy",function(n,r){var e=n.Template.Handlebars.revive({1:function(n,r,e,t,l){var o,a=n.lookupProperty||function(n,r){if(Object.prototype.hasOwnProperty.call(n,r))return n[r]};return null!=(o=n.invokePartial(a(t,"flickr-balls"),r,{name:"flickr-balls",data:l,indent:"\t",helpers:e,partials:t,decorators:n.decorators}))?o:""},3:function(n,r,e,t,l){var o,a=n.lookupProperty||function(n,r){if(Object.prototype.hasOwnProperty.call(n,r))return n[r]};return null!=(o=a(e,"if").call(null!=r?r:n.nullContext||{},null!=r?a(r,"success"):r,{name:"if",hash:{},fn:n.program(4,l,0),inverse:n.program(6,l,0),data:l,loc:{start:{line:4,column:1},end:{line:18,column:8}}}))?o:""},4:function(n,r,e,t,l){return'\t\t<svg class="icon icon-check"><use xlink:href="#icon-check"></use></svg>\n'},6:function(n,r,e,t,l){var o,a=n.lookupProperty||function(n,r){if(Object.prototype.hasOwnProperty.call(n,r))return n[r]};return null!=(o=a(e,"if").call(null!=r?r:n.nullContext||{},null!=r?a(r,"private"):r,{name:"if",hash:{},fn:n.program(7,l,0),inverse:n.program(9,l,0),data:l,loc:{start:{line:7,column:2},end:{line:17,column:9}}}))?o:""},7:function(n,r,e,t,l){return'\t\t\t<svg class="icon icon-private"><use xlink:href="#icon-private"></use></svg>\n\t\t\t<span class="dropdown-arrow">\n\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t</span>\n'},9:function(n,r,e,t,l){return'\t\t\t<svg class="icon icon-people"><use xlink:href="#icon-people"></use></svg>\n\t\t\t<span class="dropdown-arrow">\n\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t</span>\n'},compiler:[8,">= 4.3.0"],main:function(n,r,e,t,l){var o,a=n.lookupProperty||function(n,r){if(Object.prototype.hasOwnProperty.call(n,r))return n[r]};return null!=(o=a(e,"if").call(null!=r?r:n.nullContext||{},null!=r?a(r,"loading"):r,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.program(3,l,0),data:l,loc:{start:{line:1,column:0},end:{line:19,column:7}}}))?o:""},usePartial:!0,useData:!0}),t={};n.Array.each(["flickr-balls"],function(r){var e=n.Template.get("hermes/"+r);e&&(t[r]=e)}),n.Template.register("hermes/profile-bio-privacy",function(r,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,e(r,l)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("hermes-template-profile-bio-infos-edit",function(e,l){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,l,a,n,t){var s,i,c=null!=l?l:e.nullContext||{},o=e.hooks.helperMissing,p=e.escapeExpression,r=e.lambda,u=e.lookupProperty||function(e,l){if(Object.prototype.hasOwnProperty.call(e,l))return e[l]};return'<div class="infos-edit-container with-privacy">\n\t<ul>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_JOINED"},data:t,loc:{start:{line:3,column:12},end:{line:3,column:57}}}))+"</span><span>"+p("function"==typeof(i=null!=(i=u(a,"joinedDate")||(null!=l?u(l,"joinedDate"):l))?i:o)?i.call(c,{name:"joinedDate",hash:{},data:t,loc:{start:{line:3,column:70},end:{line:3,column:84}}}):i)+"</span></li>\n\t\t<li><span>"+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_OCCUPATION"},data:t,loc:{start:{line:4,column:12},end:{line:4,column:61}}}))+'</span><input type="text" name="occupation" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"occupation"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_HOMETOWN"},data:t,loc:{start:{line:5,column:12},end:{line:5,column:59}}}))+'</span><input type="text" name="hometown" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"hometown"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_CURRENT_CITY"},data:t,loc:{start:{line:6,column:12},end:{line:6,column:63}}}))+'</span><input type="text" name="city" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"city"):s,l))+'" /><span class="success-check"></span>\n\t\t\t<span class="privacy" data-privacy="location">\n'+(null!=(s=e.invokePartial(u(n,"profile-bio-privacy"),l,{name:"profile-bio-privacy",hash:{loading:!0},data:t,indent:"\t\t\t\t",helpers:a,partials:n,decorators:e.decorators}))?s:"")+"\t\t\t</span>\n\t\t</li>\n\t\t<li><span>"+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_COUNTRY"},data:t,loc:{start:{line:11,column:12},end:{line:11,column:58}}}))+'</span><input type="text" name="country" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"country"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_EMAIL"},data:t,loc:{start:{line:12,column:12},end:{line:12,column:56}}}))+'</span><span title="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"email"):s,l))+'" class="email-text">'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"email"):s,l))+'</span>\n\t\t\t<span class="privacy" data-privacy="email">\n'+(null!=(s=e.invokePartial(u(n,"profile-bio-privacy"),l,{name:"profile-bio-privacy",hash:{loading:!0},data:t,indent:"\t\t\t\t",helpers:a,partials:n,decorators:e.decorators}))?s:"")+"\t\t\t</span>\n\t\t</li>\n\t</ul>\n\t<ul>\n\t\t<li><span>"+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_WEBSITE"},data:t,loc:{start:{line:19,column:12},end:{line:19,column:58}}}))+'</span><input type="url" name="website" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"website"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_FACEBOOK"},data:t,loc:{start:{line:20,column:12},end:{line:20,column:59}}}))+'</span><input type="text" name="facebook" placeholder="'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PLACEHOLDER_SOCIAL"},data:t,loc:{start:{line:20,column:114},end:{line:20,column:167}}}))+'" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"facebook"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_TWITTER"},data:t,loc:{start:{line:21,column:12},end:{line:21,column:58}}}))+'</span><input type="text" name="twitter" placeholder="'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PLACEHOLDER_SOCIAL"},data:t,loc:{start:{line:21,column:112},end:{line:21,column:165}}}))+'" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"twitter"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_INSTAGRAM"},data:t,loc:{start:{line:22,column:12},end:{line:22,column:60}}}))+'</span><input type="text" name="instagram" placeholder="'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PLACEHOLDER_SOCIAL"},data:t,loc:{start:{line:22,column:116},end:{line:22,column:169}}}))+'" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"instagram"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_PINTEREST"},data:t,loc:{start:{line:23,column:12},end:{line:23,column:60}}}))+'</span><input type="text" name="pinterest" placeholder="'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PLACEHOLDER_SOCIAL"},data:t,loc:{start:{line:23,column:116},end:{line:23,column:169}}}))+'" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"pinterest"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.BIO_TUMBLR"},data:t,loc:{start:{line:24,column:12},end:{line:24,column:57}}}))+'</span><input type="text" name="tumblr" placeholder="'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PLACEHOLDER_SOCIAL"},data:t,loc:{start:{line:24,column:110},end:{line:24,column:163}}}))+'" value="'+p(r(null!=(s=null!=l?u(l,"profileData"):l)?u(s,"tumblr"):s,l))+'" /><span class="success-check"></span></li>\n\t\t<li class="done"><span>'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"profile.PROFILE_SAVED_AUTO"},data:t,loc:{start:{line:25,column:25},end:{line:25,column:78}}}))+'</span><span class="actions"><button class="btn done-edit">'+p((u(a,"intlMessage")||l&&u(l,"intlMessage")||o).call(c,{name:"intlMessage",hash:{intlName:"common.DONE"},data:t,loc:{start:{line:25,column:137},end:{line:25,column:175}}}))+"</button></span></li>\n\t</ul>\n</div\n"},usePartial:!0,useData:!0}),n={};e.Array.each(["profile-bio-privacy","profile-bio-privacy"],function(l){var a=e.Template.get("hermes/"+l);a&&(n[l]=a)}),e.Template.register("hermes/profile-bio-infos-edit",function(l,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,a(l,t)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-profile-bio-privacy","hermes-template-profile-bio-privacy"]});YUI.add("hermes-template-profile-tooltip",function(n,e){var t=n.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(n,e,t,a,l){var o,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,c=n.escapeExpression,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"<div>\n\t"+c("function"==typeof(o=null!=(o=s(t,"content")||(null!=e?s(e,"content"):e))?o:i)?o.call(r,{name:"content",hash:{},data:l,loc:{start:{line:2,column:1},end:{line:2,column:12}}}):o)+'\n\t<br/>\n\t<br/>\n\t<a class="close-onboarding">'+c("function"==typeof(o=null!=(o=s(t,"confirmationLink")||(null!=e?s(e,"confirmationLink"):e))?o:i)?o.call(r,{name:"confirmationLink",hash:{},data:l,loc:{start:{line:5,column:29},end:{line:5,column:49}}}):o)+"</a>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)}),n.Template.register("hermes/profile-tooltip",function(e,l){return l=l||{},l.partials=l.partials?n.merge(a,l.partials):a,t(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("profile-bio-page-view",function(e){var i=require("html-truncate");e.namespace("Views")[this.name]=e.Base.create("profile-bio-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.showcaseSetId=e.showcaseSetId,this.set("longDescriptionShown",!1),this.set("isViewingSelf",e.isViewingSelf),this.resetDoneBtnStateTimer=!1,this.privacyCheckTimeout=[],this},subviewConfig:{"profile-bio-showcase-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var i=[this.appContext.getModel("person-models",this.nsid),this.appContext.getModel("person-public-profile-models",this.nsid,{hideStats:YUI.Env.isServer}),this.appContext.getModel("person-relationship-models",this.nsid),this.appContext.getModel("person-profile-models",this.nsid)];return this.appContext.getViewer().signedIn&&i.push(this.appContext.getModel("person-models",this.appContext.getViewer().nsid)),e.Promise.all(i).then(function(e){this.set("personModel",e[0]),this.set("publicProfileData",e[1]),this.set("relationship",e[2]),this.set("personProfile",e[3]),e[4]&&this.set("viewerModel",e[4])}.bind(this))},buildContainer:function(){var i=e.URLHelper.generatePersonUrls(this.get("personModel"));return this.setContainerWithTemplate("profile-bio-page-view",{isViewingSelf:this.get("isViewingSelf"),person:this.get("personModel").toJSON(),urls:i,isMinor:this.get("personModel").getValue("isMinor"),blockUserLink:this.canBlockUser(),description:this.getDescriptions(),followingStatus:this.getFollowingStatus(),stats:this.getGeneralStats(),visiblePeople:!0,joinedDate:this.get("publicProfileData").getValue("joinedDate").format("MMMM YYYY"),profileData:this.get("publicProfileData").toJSON(),showProfileOnboardingTooltip:this.get("isViewingSelf"),hideStats:YUI.Env.isServer}),this},canBlockUser:function(){var e=!0;return(!this.appContext.getViewer().signedIn||this.get("isViewingSelf")||this.get("relationship").getValue("isIgnored"))&&(e=!1),e},getDescriptions:function(){var e,t,s=this.get("publicProfileData"),n=!1;return t=s.getValue("profileDescription"),e=s.getValue("profileDescriptionExpanded"),t&&(n={view:{longDescription:e,shortDescription:i(e,500,{keepImageTag:!0}),readMore:t.length>500},edit:{originalDescription:t}}),n},getGeneralStats:function(){var i,t=this.get("publicProfileData"),s=t.getValue("totalViews"),n=t.getValue("totalTags"),o=t.getValue("totalGeotagged"),a=t.getValue("totalFaves"),r=t.getValue("totalInGroup"),l=this.get("viewerModel");return i=l&&this.get("isViewingSelf")?l.getValue("isPro")?e.URLHelper.generatePersonUrls(this.get("viewerModel")).stats:"/account/upgrade/pro":e.URLHelper.generatePersonUrls(this.get("personModel")).photostream,{viewsLink:i,totalViewsCount:s,totalTagsCount:n,totalGeotaggedCount:o,totalFaves:a,totalInGroup:r}},getFollowingStatus:function(){var e=!1,i=this.get("personModel").getValue("displayname");return this.appContext.getViewer().signedIn&&!this.get("isViewingSelf")&&(e=this.get("relationship").getValue("isRevFamily")&&this.get("relationship").getValue("isRevFriend")?this.intlMessage({intlName:"profile.USER_IS_FRIEND_FAMILY",username:i}):this.get("relationship").getValue("isRevFriend")?this.intlMessage({intlName:"profile.USER_IS_FRIEND",username:i}):this.get("relationship").getValue("isRevFamily")?this.intlMessage({intlName:"profile.USER_IS_FAMILY",username:i}):!!this.get("relationship").getValue("isRevContact")&&this.intlMessage({intlName:"profile.USER_FOLLOWS_YOU",username:i})),e},activate:function(){var e=this.get("container");return this.appContext.getModelRegistry("person-public-profile-models").then(function(e){e.remove(this.nsid),this.appContext.getModel("person-public-profile-models",this.nsid,{hideStats:!1}).then(function(e){this.set("publicProfileData",e),this.buildContainer()}.bind(this))}.bind(this)),this.registerEventHandler(e.delegate("click",this.onReadMoreClick.bind(this),".read-more")),this.get("isViewingSelf")&&(this.registerEventHandler(e.delegate("click",this.onEditDescriptionClick.bind(this),".toggle-edit-description")),this.registerEventHandler(e.delegate("key",this.onEditDescriptionClick.bind(this),"down:13",".toggle-edit-description")),this.registerEventHandler(e.delegate("click",this.onEditDescriptionClick.bind(this),".empty-description-handler")),this.registerEventHandler(e.delegate("click",this.onSaveDescription.bind(this),".edit-description .save")),this.registerEventHandler(e.delegate("click",this.onCancelDescription.bind(this),".edit-description .cancel")),this.registerEventHandler(e.delegate("click",this.onEditInfosClick.bind(this),".toggle-edit-infos")),this.registerEventHandler(e.delegate("key",this.onEditInfosClick.bind(this),"down:13",".toggle-edit-infos")),this.registerEventHandler(e.delegate("click",this.onEditInfosClick.bind(this),".done-edit"))),this},onReadMoreClick:function(i){i.preventDefault(),i.stopPropagation();var t=this.get("container"),s=t.one(".description"),n=t.one(".read-more"),o=s.getY();this.get("longDescriptionShown")?(s.removeClass("expanded"),this.set("longDescriptionShown",!1),n.setHTML(this.intlMessage({intlName:"profile.READ_MORE"})),e.config.win.scrollTo(0,o),e.use("anim",function(e){new e.Anim({duration:.5,node:"win",easing:"easeBoth",to:{scroll:[0,o-100]}}).run()})):(s.addClass("expanded"),this.set("longDescriptionShown",!0),n.setHTML(this.intlMessage({intlName:"profile.READ_LESS"})))},onEditDescriptionClick:function(e){e.preventDefault(),e.stopPropagation();this.get("container").one(".description-container").setHTML(this.templates("profile-bio-description-edit")({description:this.getDescriptions(),isViewingSelf:this.get("isViewingSelf")})),this.set("longDescriptionShown",!1)},onCancelDescription:function(e){e.preventDefault(),e.stopPropagation();this.get("container").one(".description-container").setHTML(this.templates("profile-bio-description-view")({description:this.getDescriptions(),isViewingSelf:this.get("isViewingSelf")}))},getNewDescriptionValue:function(){return this.get("container").one("textarea.edit-desc").get("value")},onSaveDescription:function(){var e=this.get("container").one(".edit-description").all("button"),i=this.get("container").one("button.save");return e&&(e.setAttribute("disabled","disabled"),i.setHTML(this.intlMessage({intlName:"profile.SAVING"}))),this.get("publicProfileData").registry.remote.updateField({id:this.get("personModel").getValue("id"),field:"profileDescription",value:this.getNewDescriptionValue()},this.appContext).then(function(e){this.buildContainer()}.bind(this),function(e){this.buildContainer()}.bind(this))},onEditInfosClick:function(e){e.preventDefault(),e.stopPropagation();var i=this.get("container").one(".bio-infos-container");this.get("isEditingInfos")?(i.setHTML(this.templates("profile-bio-infos-view")({profileData:this.get("publicProfileData").toJSON(),joinedDate:this.get("publicProfileData").getValue("joinedDate").format("MMMM YYYY"),isViewingSelf:this.get("isViewingSelf"),showProfileOnboardingTooltip:this.get("isViewingSelf")})),this.set("isEditingInfos",!1),i.removeClass("is-editing")):(i.setHTML(this.templates("profile-bio-infos-edit")({profileData:this.get("publicProfileData").toJSON(),joinedDate:this.get("publicProfileData").getValue("joinedDate").format("MMMM YYYY"),isViewingSelf:this.get("isViewingSelf"),showProfileOnboardingTooltip:this.get("isViewingSelf")})),this.set("isEditingInfos",!0),i.addClass("is-editing"),this.isEditingTimer=!1,this.registerEventHandler(i.all("input").on("blur",this.saveNewValue.bind(this))),this.registerEventHandler(i.all("input").on("keyup",this.onPressKeyInInput.bind(this))),this.getPrivacySettings().then(this.updatePrivacyIcon))},onPressKeyInInput:function(e){if(13===e.keyCode)this.saveNewValue.call(this,e);else{var i=e.target,t=i.get("name"),s=i.get("value"),n=i.ancestor("li"),o=this.get("publicProfileData").getValue(t);if(o===s||void 0===o)return n.removeClass("success"),void i.removeClass("error");this.isEditingTimer&&clearTimeout(this.isEditingTimer),this.toggleDoneBtn(!0,!1),this.isEditingTimer=setTimeout(function(){this.saveNewValue(e)}.bind(this),1e3)}},saveNewValue:function(e){var i,t,s,n,o=e.target;if(o){if(i=o.get("name"),t=o.get("value"),s=o.ancestor("li"),n=this.get("publicProfileData").getValue(i),t!==n&&this.validateInput(i,t))return this.toggleDoneBtn(!1,!0),s.removeClass("success"),o.removeClass("error"),this.get("publicProfileData").registry.remote.updateField({id:this.get("personModel").getValue("id"),field:i,value:t},this.appContext).then(function(e){s.addClass("success"),this.toggleDoneBtn(!1,!1),"city"!==e.field&&"country"!==e.field||this.updateCoverPhotoLocation(),setTimeout(function(){s.removeClass("success")}.bind(this),3e3)}.bind(this),function(e){this.toggleDoneBtn(!1,!1),o.addClass("error")}.bind(this));t===n?(o.removeClass("error"),s.removeClass("success"),this.toggleDoneBtn(!1,!1)):(this.toggleDoneBtn(!1,!1),s.removeClass("success"),o.removeClass("error"))}},validateInput:function(e,i){return!0},updateCoverPhotoLocation:function(){if(this.get("isViewingSelf")){var e=this.get("publicProfileData"),i=[];e.getValue("city")&&i.push(e.getValue("city")),e.getValue("country")&&i.push(e.getValue("country")),this.get("personProfile").setValue("location",i.join(", "))}},toggleDoneBtn:function(e,i){var t=this.get("container").one(".done-edit");i?(t.setAttribute("disabled","disabled"),t.setHTML(this.intlMessage({intlName:"profile.SAVING"}))):e?t.setAttribute("disabled","disabled"):(this.resetDoneBtnStateTimer&&clearTimeout(this.resetDoneBtnStateTimer),this.resetDoneBtnStateTimer=setTimeout(function(){t.removeAttribute("disabled","disabled"),t.setHTML(this.intlMessage({intlName:"common.DONE"}))}.bind(this),500))},openPrivacyDropdown:function(i){i.halt();var t,s=i.target,n=s.getAttribute("data-privacy");n&&(this.privacyDropdown&&this.privacyDropdown.destroy({remove:!0}),"location"===n?t=[{text:this.intlMessage({intlName:"profile.EVERYONE"}),field:n,privacy:0,isSelected:0===this.get("privacyLocation")},{text:this.intlMessage({intlName:"profile.ANY_FLICKR_MEMBER"}),field:n,privacy:1,isSelected:1===this.get("privacyLocation")},{text:this.intlMessage({intlName:"profile.PEOPLE_I_FOLLOW"}),field:n,privacy:2,isSelected:2===this.get("privacyLocation")},{text:this.intlMessage({intlName:"profile.FRIENDS_AND_FAMILY"}),field:n,privacy:3,isSelected:3===this.get("privacyLocation")}]:"email"===n&&(t=[{text:this.intlMessage({intlName:"profile.EVERYONE"}),field:n,privacy:0,isSelected:0===this.get("privacyEmail")},{text:this.intlMessage({intlName:"profile.ANY_FLICKR_MEMBER"}),field:n,privacy:1,isSelected:1===this.get("privacyEmail")},{text:this.intlMessage({intlName:"profile.PEOPLE_I_FOLLOW"}),field:n,privacy:2,isSelected:2===this.get("privacyEmail")},{text:this.intlMessage({intlName:"profile.FRIENDS_AND_FAMILY"}),field:n,privacy:3,isSelected:3===this.get("privacyEmail")},{text:this.intlMessage({intlName:"profile.ONLY_ME"}),field:n,privacy:5,isSelected:5===this.get("privacyEmail")}]),this.privacyDropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:s,keyboardAnchorElement:s,minVerticalSpace:400,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetHorizontal:0,anchorOffsetVertical:0,menuItems:t}),this.privacyDropdown.show(),this.registerEventHandler(this.privacyDropdown.on("selected",this.onNewPrivacySelected.bind(this)),this))},onNewPrivacySelected:function(e){var i=this.get("container");if(e&&e.menuItem){var t=e.menuItem.field,s=e.menuItem.privacy,n=[];return n[t]=s,"location"===t?this.setLocationPrivacyLoading():"email"===t&&this.setEmailPrivacyLoading(),this.appContext.callAPI("flickr.account.setProfilePrivacy",n).then(function(e){"ok"===e.stat&&("location"===t?(this.set("privacyLocation",s),this.updatePrivacyIcon(i.one('span[data-privacy="location"]'),s,!0)):"email"===t&&(this.set("privacyEmail",s),this.updatePrivacyIcon(i.one('span[data-privacy="email"]'),s,!0)),this.privacyDropdown.close())}.bind(this),function(e){this.privacyDropdown.close(),this.updatePrivacyIcon()}.bind(this)).then(this.updatePrivacyIcon)}},getPrivacySettings:function(){var e=this.get("container"),i=e.one(".bio-infos-container");return this.appContext.callAPI("flickr.account.getProfilePrivacy",{timestamp:(new Date).getTime()}).then(function(t){var s=t.privacy;s?(this.set("privacyLocation",s.location),this.set("privacyEmail",s.email),this.registerEventHandler(i.all("span.privacy").on("click",this.openPrivacyDropdown.bind(this))),this.updatePrivacyIcon(e.one('span[data-privacy="location"]'),s.location,!1),this.updatePrivacyIcon(e.one('span[data-privacy="email"]'),s.email,!1)):this.updatePrivacyIcon()}.bind(this),function(e){this.updatePrivacyIcon()}.bind(this))},setLocationPrivacyLoading:function(){this.get("container").one('span[data-privacy="location"]').setHTML(this.templates("profile-bio-privacy")({loading:!0}))},setEmailPrivacyLoading:function(){this.get("container").one('span[data-privacy="email"]').setHTML(this.templates("profile-bio-privacy")({loading:!0}))},updatePrivacyIcon:function(e,i,t){this.get("container");e&&(t?(e.setHTML(this.templates("profile-bio-privacy")({loading:!1,success:!0})),this.privacyCheckTimeout[e]&&clearTimeout(this.privacyCheckTimeout[e]),this.privacyCheckTimeout[e]=setTimeout(function(){e.setHTML(this.templates("profile-bio-privacy")({loading:!1,visiblePeople:5!==i,private:5===i}))}.bind(this),1e3)):e.setHTML(this.templates("profile-bio-privacy")({loading:!1,visiblePeople:5!==i,private:5===i})))}})},"@VERSION@",{requires:["flickr-view","seo","url-helper","person-relationship-models","person-public-profile-models","person-profile-models","hermes-template-profile-bio-page-view","hermes-template-profile-bio-description-view","hermes-template-profile-bio-description-edit","hermes-template-profile-bio-infos-edit","hermes-template-profile-bio-privacy","hermes-template-profile-bio-infos-view","hermes-template-profile-tooltip","flickr-photosets-editMeta-updater","intl-number"],langBundles:["common","profile"]});YUI.add("flickr-photos-people-getContext-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-people-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.people.getContext",this._processParams(t)),s.getModelRegistry("photosof-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},function(e){throw 3===e.code&&"User not tagged in photo."===e.message&&(e.notInContext=!0),e}).then(null,e.FetcherErrorLogger(o))},_processParams:function(o){var t={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()};return o.id?t.user_id=o.id:t.path_alias=o.pathAlias,t},_processResponse:function(o,t){var s,r,n,p,a,h,i=o[0],l=o[1],d=o[2],g=o[3],u=o[4],m=o[5],c=[],x=[],y=d.proxy(t.photoId),M=[];return s=i.prevphotos,r=i.nextphotos,x=e.APIHelper.response.parsePhotos({photos:s.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),c=e.APIHelper.response.parsePhotos({photos:r.photo,personModelRegistry:g,photoModelRegistry:d,photoEngagementModelRegistry:u,photoStatsModelRegistry:m}),a=l.getValue(t.id,"photoContextList"),n=!!a.hasMinBoundary&&a.hasMinBoundary(),p=!!a.hasMaxBoundary&&a.hasMaxBoundary(),h=a.getList(),M=e.APIHelper.response.addOrReplaceListByContext({model:y,next:x,prev:c.reverse(),current:h,hasMin:n,hasMax:p,numNext:t.numNext,numPrev:t.numPrev}),l.setValue(t.id,"photoContextList",M),{next:x,previous:c.reverse()}}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photosof-models","photo-models","person-models","photo-engagement-models","photo-stats-models"]});YUI.add("photosof-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotosOf"].run(t,this.appContext)}},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"photos of"}},title:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t,o=this.appContext.getViewer();return o&&o.nsid===e?"Photos of you":(t=this.getValue(e,"owner"))?"Photos of "+t.getValue("displayname"):"Photos of"}},pathAlias:{validator:function(t,o){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},owner:{isModel:!0},photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotosOf"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-people-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return"/people/"+(t?t.getValue("pathAlias"):e)+"/photosof/"}},urlSuffix:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){return"photosof-"+this.getValue(e,"owner").getValue("pathAlias")}},totalItems:{validator:function(t,o){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-people-getPhotosOf-fetcher","flickr-photos-people-getContext-fetcher"]});YUI.add("flickr-people-getPhotosOf-fetcher",function(e,o){"use strict";e.namespace("ListFetchers")["flickr-people-getPhotosOf"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.people.getPhotosOf",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photosof-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then(function(e){return r._processResponse(e,t)},e.FetcherErrorLogger(o))},_processParams:function(o){var t;if(t={extras:e.APIHelper.request.getRebootPhotoExtras(),per_page:o.perPage||20,page:o.page||1,get_user_info:1},o.id)t.user_id=o.id;else{if(!o.pathAlias)throw new Error("[flickr-people-getPhotosOf-fetcher] `id` or `pathAlias` is required.");t.path_alias=o.pathAlias}return t},_processResponse:function(o,t){var s,r,p=o[0],a=o[1],i=o[2],l=o[3],h=o[4],n=o[5];return s={id:p.user.nsid,pathAlias:p.user.pathAlias,totalItems:parseInt(p.photos.total,10)},r=e.APIHelper.response.parsePerson(p.user),s.owner=i.addOrUpdate(r),s.photoPageList=e.APIHelper.response.parsePhotos({photos:p.photos.photo,personModelRegistry:i,photoModelRegistry:a,photoEngagementModelRegistry:h,photoStatsModelRegistry:n}),l.addOrUpdate(s),s.photoPageList}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-models","person-models","photosof-models","photo-engagement-models","photo-stats-models"]});